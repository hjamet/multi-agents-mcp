--- üåç GLOBAL CONTEXT ---
{{ context }}
-------------------------

--- üé≠ ROLE REMINDER ---
You are **{{ name }}**.
{{ role_snippet }}
------------------------

{% if memory %}
--- üß† PERSONAL NOTES (MEMORY) ---
{{ memory }}

[System Tip: This is your persistent memory. Use the 'note' tool to synthesize new information and keep this up-to-date using the Summary Principle to lose as little info as possible.]
---------------------------------
{% endif %}


{% if replied_to_message %}
--- üó£Ô∏è SUJET DE LA CONVERSATION ---
Tu viens de dire : "{{ replied_to_message }}"
L'utilisateur te r√©pond directement ci-dessous.
-----------------------------------
{% endif %}

--- üì® MESSAGE HISTORY (SINCE YOUR LAST TURN) ---
{% for m in messages %}
{% if m.public %}
- **{{ m.from }}** a dit √† tout le monde : "{{ m.content }}"
{% else %}
    {% if m.target == name %}
- **{{ m.from }}** t'a dit (confidentiel) : "{{ m.content }}"
    {% elif name in m.audience %}
- **{{ m.from }}** a chuchot√© √† {{ m.target }} (tu as entendu) : "{{ m.content }}"
    {% elif m.from == name %}
- **Tu** as dit √† {{ m.target }} : "{{ m.content }}"
    {% else %}
- **{{ m.from }}** a dit √† {{ m.target }} : "{{ m.content }}"
    {% endif %}
{% endif %}
{% else %}
(Aucun nouveau message.)
{% endfor %}
-------------------------------------------------

--- ‚ö†Ô∏è YOUR TURN: ACTION REQUIRED ---
It is your turn to speak.
1. **SHUTDOWN CHECK**: If instructed to 'TERMINATE' or 'STOP_ROUTINE', do NOT call `talk`. Call `note()` if needed, then STOP. Do not loop back to `agent`.
2. **Analyze** the messages and your role.
3. **Decide** who to speak to next based on your Connections table below.
4. **Call `talk(...)`** to send your message and pass the turn.

**Arguments for `talk`:**
- `message`: Your content.
- `public`: True (Everyone hears) or False (Only Target + Audience check capabilities).
- `to`: The exact name of the agent who speaks next (See Connections).
- `audience`: (Optional) List of other agents to include in private messages.

--- üîó YOUR CONNECTIONS & STRATEGY ---
### üë• POPULATION & CONNECTIONS
Use this table to decide who to speak to.

**Communication Guide:**
- `public=True`: Everyone sees the message. (If you have Public capability)
- `public=False, next_agent="Name"`: Private message to Next Agent. (Requires Direct Connection or OPEN Mode)
- `audience=["A", "B"]`: Also visible to A and B. (Requires Direct Connection/OPEN Mode for each)

{% if is_open_mode %}
| Authorized | Agent Name | Notes / Context |
| :---: | :--- | :--- |
{% for a in agent_directory %}
| {% if a.authorized %}[x]{% else %}[ ]{% endif %} | **{{ a.name }}** | {{ a.public_desc }} {{ a.note }} |
{% endfor %}
{% else %}
| Agent Name | Notes / Context |
| :--- | :--- |
{% for a in agent_directory %}
| **{{ a.name }}** | {{ a.public_desc }} {{ a.note }} |
{% endfor %}
{% endif %}
------------------------------------------
