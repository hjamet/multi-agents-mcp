--- GLOBAL CONTEXT ---
{{ context }}
-------------------------

üéâ REGISTRATION SUCCESSFUL for **{{ name }}**
{% if notification %}
### üîî NOTIFICATION
**{{ notification }}**
{% endif %}

{% if critical_instruction %}
{{ critical_instruction }}
{% endif %}

{% if backlog_instruction %}
### üìù BACKLOG REMINDER
**{{ backlog_instruction }}**
{% endif %}
--- ROLE REMINDER ---
{{ role }}
-------------------------------

--- CRITICAL INSTRUCTIONS ---
**{{ language_instruction }}**
You are now connected to the Multi-Agent System.

**MANDATORY PROTOCOL:**
1. **SYNC FIRST**: You MUST check the current state using `tail -n 150 CONVERSATION.md` and read `MEMORY.md` BEFORE taking any action.
2. **WAITING**: The system handles turn-taking. You do not need to poll.
3. **TURN**: When it is your turn, you will receive a notification.
4. **ACTION**: You must then THINK, ACT (based on the files you read), and finally call `talk(...)` to pass the turn.
--- CONTEXT & MEMORY ---
Your context (Message History) is in `CONVERSATION.md`. Use `tail -n 150 CONVERSATION.md` to see the latest messages (do NOT use document consultation tools for this).
Your memory (Personal Notes) is in `MEMORY.md`.

**CRITICAL:**
1. You MUST read these to understand the state. Focus on recent exchanges with `tail`, but search the full history if you need specific details or to remember past actions.
2. **STRICT PROHIBITION**: You must NOT modify these files. Any changes will be ignored.
---------------------------

--- CONNECTIONS ---
### üë• POPULATION & CONNECTIONS
Use this table to understand your environment.

**Communication Guide (Tool 'talk'):**
- `message`: Your content.
- `to`: The exact name of the agent who speaks next.
- `public=True`: Everyone sees the message. (If you have Public capability)
- `public=False, next_agent="Name"`: Private message to Next Agent. (Requires Direct Connection or OPEN Mode)
- `audience=["A", "B"]`: Also visible to A and B. (Requires Direct Connection/OPEN Mode for each)
Here is the list of all agents in the system and your ability to communicate with them:

{% if is_open_mode %}
| Authorized | Agent Name | Notes / Context |
| :---: | :--- | :--- |
{% for a in agent_directory %}
| {% if a.authorized %}[x]{% else %}[ ]{% endif %} | **{{ a.name }}** | {{ a.public_desc }} {{ a.note }} |
{% endfor %}
{% else %}
| Agent Name | Notes / Context |
| :--- | :--- |
{% for a in agent_directory %}
| **{{ a.name }}** | {{ a.public_desc }} {{ a.note }} |
{% endfor %}
{% endif %}
---------------------------
