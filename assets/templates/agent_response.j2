<global_context>
{{ context }}
</global_context>

<registration_status>
ðŸŽ‰ REGISTRATION SUCCESSFUL for **{{ name }}**
</registration_status>

{% if notification %}
<notification>
**{{ notification }}**
</notification>
{% endif %}


{% if backlog_instruction %}
<backlog_reminder>
**{{ backlog_instruction }}**
</backlog_reminder>
{% endif %}

<role_reminder>
{{ role }}
</role_reminder>

<critical_instructions>
**{{ language_instruction }}**
You are now connected to the Multi-Agent System.

**MANDATORY PROTOCOL:**
1. **SYNC FIRST**: Read the Context & Memory below carefully.
2. **WAITING**: The system handles turn-taking. You do not need to poll.
3. **TURN**: When it is your turn, you will receive a notification.
4. **ACTION**: You must then THINK, ACT (based on the files you read), and finally call `talk(...)` to pass the turn.
</critical_instructions>

<conversation_history>
{{ conversation_history }}
</conversation_history>

<memory>
{{ memory_content }}
</memory>

<connections>
Use this table to understand your environment.

**Communication Guide (Tool 'talk'):**
- `message`: Your content.
- `to`: The exact name of the agent who speaks next.
- `public=True`: Everyone sees the message. (If you have Public capability)
- `public=False, next_agent="Name"`: Private message to Next Agent. (Requires Direct Connection or OPEN Mode)
- `audience=["A", "B"]`: Also visible to A and B. (Requires Direct Connection/OPEN Mode for each)
Here is the list of all agents in the system and your ability to communicate with them:

{% if is_open_mode %}
| Authorized | Agent Name | Notes / Context |
| :---: | :--- | :--- |
{% for a in agent_directory %}
| {% if a.authorized %}[x]{% else %}[ ]{% endif %} | **{{ a.name }}** | {{ a.public_desc }} {{ a.note }} |
{% endfor %}
{% else %}
| Agent Name | Notes / Context |
| :--- | :--- |
{% for a in agent_directory %}
| **{{ a.name }}** | {{ a.public_desc }} {{ a.note }} |
{% endfor %}
{% endif %}
</connections>
