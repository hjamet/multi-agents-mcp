--- GLOBAL CONTEXT ---
{{ context }}
-------------------------

üéâ REGISTRATION SUCCESSFUL for **{{ name }}**
{% if notification %}
### üîî NOTIFICATION
**{{ notification }}**
{% endif %}

{% if critical_instruction %}
{{ critical_instruction }}
{% endif %}

{% if backlog_instruction %}
### üìù BACKLOG REMINDER
**{{ backlog_instruction }}**
{% endif %}
--- ROLE REMINDER ---
{{ role }}
-------------------------------

--- CRITICAL INSTRUCTIONS ---
**{{ language_instruction }}**
You are now connected to the Multi-Agent System.

**MANDATORY PROTOCOL:**
1. **SYNC FIRST**: Read the Context & Memory below carefully.
2. **WAITING**: The system handles turn-taking. You do not need to poll.
3. **TURN**: When it is your turn, you will receive a notification.
4. **ACTION**: You must then THINK, ACT (based on the files you read), and finally call `talk(...)` to pass the turn.
--- CONTEXT & MEMORY ---
### üìú LATEST CONVERSATION HISTORY (Last 10 Messages)
{{ conversation_history }}

### üß† YOUR MEMORY (Personal Notes)
{{ memory_content }}

**CRITICAL:**
1. This is the **REAL** state. Do NOT try to read `CONVERSATION.md` or `MEMORY.md` anymore.
2. If you need more history, rely on your memory or ask others (or use `read_file` on logs if absolutely necessary and authorized).
---------------------------

--- CONNECTIONS ---
### üë• POPULATION & CONNECTIONS
Use this table to understand your environment.

**Communication Guide (Tool 'talk'):**
- `message`: Your content.
- `to`: The exact name of the agent who speaks next.
- `public=True`: Everyone sees the message. (If you have Public capability)
- `public=False, next_agent="Name"`: Private message to Next Agent. (Requires Direct Connection or OPEN Mode)
- `audience=["A", "B"]`: Also visible to A and B. (Requires Direct Connection/OPEN Mode for each)
Here is the list of all agents in the system and your ability to communicate with them:

{% if is_open_mode %}
| Authorized | Agent Name | Notes / Context |
| :---: | :--- | :--- |
{% for a in agent_directory %}
| {% if a.authorized %}[x]{% else %}[ ]{% endif %} | **{{ a.name }}** | {{ a.public_desc }} {{ a.note }} |
{% endfor %}
{% else %}
| Agent Name | Notes / Context |
| :--- | :--- |
{% for a in agent_directory %}
| **{{ a.name }}** | {{ a.public_desc }} {{ a.note }} |
{% endfor %}
{% endif %}
---------------------------
